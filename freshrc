# Keep fresh up to date
fresh freshshell/fresh bin/fresh --bin

# We use FRESH_LOCAL to find the ~/.dotfiles directory,
# in case it's somewhere else - so populate it if blank
FRESH_LOCAL=${FRESH_LOCAL-~/.dotfiles}

cd $FRESH_LOCAL

# ~/. files
fresh rc/\*   --file

# scripts
fresh bin/\*  --bin

# generic shell
fresh shell/aliases/\*
fresh shell/config/\*

# Use google to evaluate expressions
fresh pengwynn/dotfiles bin/gxpr --bin

# vim
fresh-options --file=~/.vimrc --marker=\"
  fresh twe4ked/dotfiles vim/vundle_before.vim
  fresh apps/vim/vundle.vim
  fresh twe4ked/dotfiles vim/vundle_after.vim

  fresh apps/vim/global.vim
  fresh apps/vim/appearance.vim
  fresh apps/vim/indent.vim
  fresh apps/vim/search.vim

  fresh apps/vim/keys.vim
  fresh apps/vim/syntax.vim
fresh-options

each_in_path() {
  # Fresh each file in the source directory
  # to one with the same name in the destination directory.
  #   $1  source directory
  #   $2  destination directory
  find "$1" -type f -print0 | while IFS= read -r -d $'\0' path; do
    file=`basename "$path"`
    fresh "$path" --file="$2/$file"
  done
}

# sublime text 3
each_in_path "apps/st3" "~/.config/sublime-text-3/Packages/User"

# konsole
fresh config/konsolerc --file=~/.config/konsolerc
each_in_path "apps/konsole" "~/.local/share/konsole"
# For an old version of konsole/kde
#each_in_path "apps/konsole" "~/.kde/share/apps/konsole"

# mutt
each_in_path "apps/mutt" "~/.mutt"

# openbox
each_in_path "apps/openbox" "~/.config/openbox"
fresh config/autostart --bin=~/.config/openbox/autostart
fresh config/environment --bin=~/.config/openbox/environment

fresh config/tint2rc --file=~/.config/tint2/tint2rc
fresh config/sxhkdrc --file=~/.config/sxhkd/sxhkdrc
fresh config/dunstrc --file=~/.config/dunst/dunstrc

# wmutils/contrib
fresh wmutils/contrib \*.sh --bin

# upload screenshot to imgur
fresh jomo/imgur-screenshot imgur-screenshot.sh --bin

# bash
fresh-options --file=~/.bashrc
  fresh freshshell/fresh contrib/source-build.sh
  fresh freshshell/fresh contrib/completion/fresh-completion.bash
  fresh shell/bash/\*
fresh-options

# zsh
fresh-options --file=~/.zshrc
  fresh freshshell/fresh contrib/source-build.sh
  fresh freshshell/fresh contrib/completion/fresh-completion.zsh
  fresh shell/zsh/\*
fresh-options

# fonts
# TODO: Perhaps we should have a go at downloading and extracting the fonts instead.
# eg: https://github.com/adobe-fonts/source-code-pro/archive/2.010R-ro/1.030R-it.tar.gz
# (downloading the latest version might be better?)
fresh fonts                --file=~/.fonts/

# SSH Config
# Pull all the files in the repo, concatenate them and then append the "Hostname" to each "Host"
fresh git@bitbucket.org:lewiseason/ssh_config.git \* --file=~/.ssh/config --filter="perl -0 -pe 's/\nHost ([^\s]*)\nHostname (.*)\n/\nHost \1 \2\nHostname \2\n/g'"

fresh config/redshift.conf --file=~/.config/redshift.conf

fresh config/unison_home.prf --file=~/.unison/home.prf --filter='sed "s/\$USER/$USER/g"'

fresh config/subversion --file=~/.subversion/conf

# ln -sf ~/.dotfiles/foo ~/.config/foo

fresh_after_build() {
  fc-cache ~/.fonts

  # Download any new wallpapers
  ~/bin/wallpaper &

  # Stop konsole from moaning
  chmod u+w ~/.config/konsolerc
}
