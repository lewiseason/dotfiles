# Keep fresh up to date
fresh freshshell/fresh bin/fresh  --bin

# We use FRESH_LOCAL to find the ~/.dotfiles directory,
# in case it's somewhere else - so populate it if blank
FRESH_LOCAL=${FRESH_LOCAL-~/.dotfiles}

cd $FRESH_LOCAL

# ~/. files
fresh rc/\*      --file

# scripts
fresh bin/\*     --bin

# generic shell
fresh shell/aliases/\*
fresh shell/config/\*

# vim
fresh-options --file=~/.vimrc --marker=\"
  fresh twe4ked/dotfiles vim/vundle_before.vim
  fresh apps/editors/vim/vundle.vim
  fresh twe4ked/dotfiles vim/vundle_after.vim

  fresh apps/editors/vim/global.vim
  fresh apps/editors/vim/appearance.vim
  fresh apps/editors/vim/indent.vim
  fresh apps/editors/vim/search.vim

  fresh apps/editors/vim/keys.vim
fresh-options

each_in_path() {
  # Fresh each file in the source directory
  # to one with the same name in the destination directory.
  #   $1  source directory
  #   $2  destination directory
  find "$1" -type f -print0 | while IFS= read -r -d $'\0' path; do
    file=`basename "$path"`
    fresh "$path" --file="$2/$file"
  done
}

# sublime text 3
each_in_path "apps/editors/st3" "~/.config/sublime-text-3/Packages/User"

# konsole (kde4)
each_in_path "apps/terminals/konsole" "~/.kde/share/apps/konsole"
# konsole (kde5)
each_in_path "apps/terminals/konsole" "~/.local/share/konsole"

# bash
fresh-options --file=~/.bashrc
  fresh freshshell/fresh contrib/source-build.sh
  fresh freshshell/fresh contrib/completion/fresh-completion.bash
  fresh shell/bash/\*
fresh-options

# zsh
fresh-options --file=~/.zshrc
  fresh freshshell/fresh contrib/source-build.sh
  fresh freshshell/fresh contrib/completion/fresh-completion.zsh
  fresh shell/zsh/\*
fresh-options

# fonts
fresh fonts                --file=~/.fonts/

# SSH Config
# Pull all the files in the repo, concatenate them and then append the "Hostname" to each "Host"
fresh git@bitbucket.org:lewiseason/ssh_config.git \* --file=~/.ssh/config --filter="perl -0 -pe 's/\nHost (.*)\nHostname (.*)\n/\nHost \1 \2\nHostname \2\n/g'"

fresh config/redshift.conf --file=~/.config/redshift.conf

fresh config/powerline-symbols.conf --file=~/.config/fontconfig/conf.d/10-powerline-symbols.conf
fresh config/powerline-tmux.json    --file=~/.config/powerline/themes/tmux/default.json

fresh config/unison_home.prf        --file=~/.unison/home.prf --filter='sed "s/\$USER/$USER/g"'

# ln -sf ~/.dotfiles/foo ~/.config/foo

fresh_after_build() {
  fc-cache ~/.fonts
}
